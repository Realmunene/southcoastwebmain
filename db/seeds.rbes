# db/seeds.rb
require 'countries'

# --------------------
# Seed Nationalities
# --------------------
puts "ğŸŒ Seeding nationalities..."
Nationality.destroy_all

ISO3166::Country.all
  .sort_by { |c| c.translations['en'] || c.name }
  .each do |c|
    country_name = c.translations['en'] || c.name
    Nationality.find_or_create_by!(name: country_name)
  end

puts "âœ… Seeded #{Nationality.count} nationalities."

# --------------------
# Seed Room Types (with prices)
# --------------------
puts "ğŸ¨ Seeding room types..."

room_options = [
  { name: "1-Executive Room - 2Pax-X3", price: 65 },
  { name: "2-Connected Room - 4Pax-X3", price: 100 },
  { name: "2 Bedroom Apartment with Living + Kitchen + Balcony - 4Pax-X2", price: 110 },
  { name: "3-BedRoom Apartment with Kitchen and Balcony - 6Pax-X1", price: 125 },
  { name: "2-Connected Room, I-Ensuite - 4Pax-X2", price: 110 },
  { name: "2-BedRoom Apartment with Kitchen, 1-Ensuite", price: 125 },
  { name: "Larger Apartment with Kitchen + Balcony + Living - 4Pax-X1", price: 140 }
]

RoomType.destroy_all
room_options.uniq { |r| r[:name] }.each do |room|
  RoomType.find_or_create_by!(name: room[:name]) do |rt|
    rt.price = room[:price]
  end
end

puts "âœ… Seeded #{RoomType.count} unique room types with prices."

# --------------------
# Seed Admin Users
# --------------------
puts "ğŸ‘‘ Seeding admin users..."

# Super admin configuration
super_admins = [
  { email: "southcoastoutdoors25@gmail.com", name: "Super Admin (Main)" }
]

super_admins.each do |sa|
  admin = Admin.find_or_initialize_by(email: sa[:email])
  admin.name = sa[:name]
  admin.role = :super_admin
  admin.password = "Admin@123"
  admin.password_confirmation = "Admin@123"

  if admin.save
    puts "âœ… Super Admin active: #{sa[:email]}"
  else
    puts "âš ï¸ Issue creating Super Admin #{sa[:email]}: #{admin.errors.full_messages.join(', ')}"
  end
end

# Backup admin (create only if no admin exists)
if Admin.admin.none?
  backup_admin = Admin.new(
    email: "admin@example.com",
    name: "System Administrator",
    role: :admin,
    password: "Admin123!",
    password_confirmation: "Admin123!"
  )

  if backup_admin.save
    puts "âœ… Backup Admin user created: admin@example.com"
  else
    puts "âš ï¸ Backup admin creation issue: #{backup_admin.errors.full_messages.join(', ')}"
  end
else
  puts "â„¹ï¸ Additional admin(s) already exist. No backup admin created."
end

puts "âœ… Total Admin Users: #{Admin.count}"
puts "ğŸ‰ Seeding complete!"
