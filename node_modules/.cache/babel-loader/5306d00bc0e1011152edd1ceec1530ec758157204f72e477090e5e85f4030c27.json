{"ast":null,"code":"import _objectSpread from\"/root/southcoastwebmain/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from\"react\";import jsPDF from\"jspdf\";import logo from\"./images/IMG-20251008-WA0008logo0.png\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{faDownload,faTimes,faCreditCard,faSync,faHome,faExclamationTriangle,faCheckCircle,faClock,faReceipt,faCalendarDay}from\"@fortawesome/free-solid-svg-icons\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function MyBookings(){const[bookings,setBookings]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[roomPrices,setRoomPrices]=useState({});const[processingPayment,setProcessingPayment]=useState({});const[loadingRoomPrices,setLoadingRoomPrices]=useState(true);const[exchangeRate,setExchangeRate]=useState(null);const[loadingExchangeRate,setLoadingExchangeRate]=useState(true);const[generatingPDF,setGeneratingPDF]=useState({});const[pollingIntervals,setPollingIntervals]=useState({});const[showPaymentModal,setShowPaymentModal]=useState(false);const[currentBooking,setCurrentBooking]=useState(null);const[paymentAmount,setPaymentAmount]=useState(\"\");const[phoneNumber,setPhoneNumber]=useState(\"\");const[paymentErrors,setPaymentErrors]=useState({});const phoneInputRef=useRef(null);// Production API base URL\nconst API_BASE_URL=process.env.REACT_APP_API_BASE_URL||'http://127.0.0.1:3000/api/v1';useEffect(()=>{fetchBookings();fetchRoomPrices();fetchExchangeRate();return()=>{Object.values(pollingIntervals).forEach(interval=>clearInterval(interval));};},[]);// Fetch exchange rate\nconst fetchExchangeRate=async()=>{try{setLoadingExchangeRate(true);const response=await fetch('https://api.exchangerate-api.com/v4/latest/USD');if(!response.ok){throw new Error('Failed to fetch exchange rate');}const data=await response.json();const kesRate=data.rates.KES;if(!kesRate){throw new Error('KES rate not available');}setExchangeRate(kesRate);}catch(error){console.warn(\"Using fallback exchange rate:\",error);setExchangeRate(130);}finally{setLoadingExchangeRate(false);}};// Fetch room prices\nconst fetchRoomPrices=async()=>{try{setLoadingRoomPrices(true);const response=await fetch(\"\".concat(API_BASE_URL,\"/room_types\"));if(!response.ok){throw new Error('Failed to fetch room prices');}const roomTypes=await response.json();const prices={};roomTypes.forEach(room=>{prices[room.name]=room.price;});setRoomPrices(prices);}catch(error){console.error(\"Error fetching room prices:\",error);setError(\"Awaiting response from server for room prices\");}finally{setLoadingRoomPrices(false);}};const fetchBookings=async()=>{try{setLoading(true);setError(null);const storedUser=JSON.parse(localStorage.getItem(\"user\"));if(!(storedUser!==null&&storedUser!==void 0&&storedUser.token)){setError(\"Please log in to view your bookings\");setLoading(false);return;}const response=await fetch(\"\".concat(API_BASE_URL,\"/bookings\"),{method:\"GET\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(storedUser.token)}});const responseText=await response.text();let data;try{data=JSON.parse(responseText);}catch(parseError){console.error(\"JSON Parse Error:\",parseError);throw new Error(\"Server returned an invalid response. Please check if the backend is running properly.\");}if(!response.ok){if(response.status===401)setError(\"Unauthorized. Please log in again.\");else throw new Error(data.error||data.message||\"Failed to fetch bookings: \".concat(response.status));setLoading(false);return;}const bookingsData=Array.isArray(data)?data:[];setBookings(bookingsData);// FIX: Restart polling for any bookings that are still pending\nbookingsData.forEach(booking=>{if(booking.payment_status==='pending'&&!pollingIntervals[booking.id]){console.log(\"\\uD83D\\uDD04 Restarting polling for booking \".concat(booking.id));startPaymentStatusPolling(booking.id);}});}catch(err){console.error(\"Error fetching bookings:\",err);if(err.message.includes(\"Failed to fetch\")){setError(\"Cannot connect to server. Please check your internet connection.\");}else if(err.message.includes(\"Server returned an invalid response\")){setError(\"Server error: The backend is not responding properly. Please try again later.\");}else{setError(err.message||\"Failed to load bookings\");}}finally{setLoading(false);}};const formatDate=dateString=>new Date(dateString).toLocaleDateString(\"en-US\",{year:\"numeric\",month:\"long\",day:\"numeric\"});const getStatusBadge=(checkIn,checkOut)=>{const today=new Date();const checkInDate=new Date(checkIn);const checkOutDate=new Date(checkOut);if(today<checkInDate)return/*#__PURE__*/_jsx(\"span\",{className:\"bg-blue-100 text-blue-800 text-xs font-medium px-3 py-1 rounded-full\",children:\"Upcoming\"});else if(today>=checkInDate&&today<=checkOutDate)return/*#__PURE__*/_jsx(\"span\",{className:\"bg-green-100 text-green-800 text-xs font-medium px-3 py-1 rounded-full\",children:\"Active\"});else return/*#__PURE__*/_jsx(\"span\",{className:\"bg-gray-100 text-gray-800 text-xs font-medium px-3 py-1 rounded-full\",children:\"Completed\"});};// Convert USD to KES\nconst convertToKES=usdAmount=>{if(!exchangeRate||!usdAmount)return 0;return Math.round(usdAmount*exchangeRate);};// Calculate total price\nconst calculateTotalPrice=booking=>{const roomPriceUSD=roomPrices[booking.room_type];if(!roomPriceUSD)return null;const roomPriceKES=convertToKES(roomPriceUSD);const numberOfNights=Math.ceil((new Date(booking.check_out)-new Date(booking.check_in))/(1000*60*60*24));const totalPriceKES=roomPriceKES*numberOfNights;return{roomPriceUSD,roomPriceKES,numberOfNights,totalPriceKES,pricePerNightKES:roomPriceKES};};const handleCancelBooking=async bookingId=>{if(!window.confirm(\"Are you sure you want to cancel this booking? This action cannot be undone.\"))return;try{const storedUser=JSON.parse(localStorage.getItem(\"user\"));const response=await fetch(\"\".concat(API_BASE_URL,\"/bookings/\").concat(bookingId),{method:\"DELETE\",headers:{Authorization:\"Bearer \".concat(storedUser.token)}});const responseText=await response.text();let data;try{data=JSON.parse(responseText);}catch(parseError){console.error(\"JSON Parse Error:\",parseError);throw new Error(\"Server returned an invalid response. Please check if the backend is running properly.\");}if(response.ok){alert(\"Booking cancelled successfully! Cancellation emails have been sent to you and the admin.\");fetchBookings();}else{throw new Error(data.error||data.message||\"Failed to cancel booking\");}}catch(err){console.error(\"Error cancelling booking:\",err);if(err.message.includes(\"Failed to fetch\")){alert(\"Cannot connect to server. Please check your internet connection.\");}else if(err.message.includes(\"Server returned an invalid response\")){alert(\"Server error: The backend is not responding properly. Please try again later.\");}else{alert(\"Failed to cancel booking. Please try again.\");}}};// Enhanced Phone Number Validation with Better Formatting\nconst validatePhoneNumber=phone=>{const cleanPhone=phone.replace(/\\D/g,'');const phoneRegex=/^(?:254|\\+254|0)?(7[0-9]{8})$/;const match=cleanPhone.match(phoneRegex);if(!match){return{isValid:false,error:\"Please enter a valid Kenyan phone number starting with 07 or 254\"};}const formattedPhone=\"254\".concat(match[1]);return{isValid:true,formattedPhone,error:null};};// Enhanced Phone Number Formatting for Display\nconst formatPhoneDisplay=phone=>{const cleanPhone=phone.replace(/\\D/g,'');if(cleanPhone.startsWith('254')&&cleanPhone.length===12){return\"254 \".concat(cleanPhone.slice(3,6),\" \").concat(cleanPhone.slice(6,9),\" \").concat(cleanPhone.slice(9));}else if(cleanPhone.startsWith('0')&&cleanPhone.length===10){return\"\".concat(cleanPhone.slice(0,4),\" \").concat(cleanPhone.slice(4,7),\" \").concat(cleanPhone.slice(7));}else if(cleanPhone.startsWith('7')&&cleanPhone.length===9){return\"0\".concat(cleanPhone.slice(0,3),\" \").concat(cleanPhone.slice(3,6),\" \").concat(cleanPhone.slice(6));}return phone;};// FIXED: Enhanced Phone Number Input Handler - No more single digit issue\nconst handlePhoneNumberChange=value=>{var _phoneInputRef$curren;// Store current cursor position\nconst cursorPosition=((_phoneInputRef$curren=phoneInputRef.current)===null||_phoneInputRef$curren===void 0?void 0:_phoneInputRef$curren.selectionStart)||0;// Remove all non-digits\nconst digitsOnly=value.replace(/\\D/g,'');let formatted=digitsOnly;// Handle different starting formats\nif(digitsOnly.startsWith('0')&&digitsOnly.length<=10){formatted=digitsOnly;}else if(digitsOnly.startsWith('254')&&digitsOnly.length<=12){formatted=digitsOnly;}else if(digitsOnly.startsWith('7')&&digitsOnly.length<=9){formatted=\"0\".concat(digitsOnly);}else if(digitsOnly.length>0){formatted=\"0\".concat(digitsOnly.slice(-9));}// Limit length based on format\nif(formatted.length>(formatted.startsWith('254')?12:10)){formatted=formatted.slice(0,formatted.startsWith('254')?12:10);}setPhoneNumber(formatted);// Clear phone errors when user starts typing\nif(paymentErrors.phone){setPaymentErrors(prev=>_objectSpread(_objectSpread({},prev),{},{phone:null}));}// Restore cursor position after state update\nsetTimeout(()=>{if(phoneInputRef.current){const newCursorPosition=Math.min(cursorPosition,formatted.length);phoneInputRef.current.setSelectionRange(newCursorPosition,newCursorPosition);}},0);};// Payment amount validation\nconst validatePaymentAmount=(amount,maxAmount)=>{const numAmount=parseFloat(amount);if(isNaN(numAmount)||numAmount<=0){return{isValid:false,error:\"Please enter a valid payment amount\"};}if(numAmount>maxAmount){return{isValid:false,error:\"Payment amount cannot exceed KES \".concat(maxAmount.toLocaleString())};}if(numAmount<10){return{isValid:false,error:\"Minimum payment amount is KES 10\"};}return{isValid:true,error:null};};// Enhanced Amount Input Handler\nconst handleAmountChange=value=>{// Only allow numbers and decimal point\nconst cleanValue=value.replace(/[^\\d.]/g,'');// Ensure only one decimal point\nconst parts=cleanValue.split('.');if(parts.length>2){return;}// Limit decimal places to 2\nif(parts[1]&&parts[1].length>2){return;}setPaymentAmount(cleanValue);if(paymentErrors.amount){setPaymentErrors(prev=>_objectSpread(_objectSpread({},prev),{},{amount:null}));}};// Open payment modal\nconst openPaymentModal=(booking,totalAmount)=>{setCurrentBooking(booking);setPaymentAmount(totalAmount.toString());setPhoneNumber(\"\");setPaymentErrors({});setShowPaymentModal(true);};// Close payment modal\nconst closePaymentModal=()=>{setShowPaymentModal(false);setCurrentBooking(null);setPaymentAmount(\"\");setPhoneNumber(\"\");setPaymentErrors({});};// FIXED: Handle M-Pesa payment with corrected parameters\nconst handleMpesaPayment=async()=>{if(!currentBooking)return;setPaymentErrors({});// Validate phone number\nconst phoneValidation=validatePhoneNumber(phoneNumber);if(!phoneValidation.isValid){setPaymentErrors({phone:phoneValidation.error});return;}// Validate payment amount\nconst currentBookingPriceDetails=getCurrentBookingPriceDetails();if(!currentBookingPriceDetails){setPaymentErrors({amount:\"Unable to calculate booking amount\"});return;}const amountValidation=validatePaymentAmount(paymentAmount,currentBookingPriceDetails.totalPriceKES);if(!amountValidation.isValid){setPaymentErrors({amount:amountValidation.error});return;}setProcessingPayment(prev=>_objectSpread(_objectSpread({},prev),{},{[currentBooking.id]:true}));try{const storedUser=JSON.parse(localStorage.getItem(\"user\"));if(!(storedUser!==null&&storedUser!==void 0&&storedUser.token)){throw new Error(\"Authentication required. Please log in again.\");}// FIXED: Remove unpermitted parameters that were causing server warnings\nconst paymentData={payment:{phone:phoneValidation.formattedPhone,amount:parseFloat(paymentAmount)}};console.log(\"Initiating M-Pesa payment:\",paymentData);const response=await fetch(\"\".concat(API_BASE_URL,\"/bookings/\").concat(currentBooking.id,\"/payments\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(storedUser.token)},body:JSON.stringify(paymentData)});const responseText=await response.text();let data;try{data=JSON.parse(responseText);}catch(parseError){console.error(\"JSON Parse Error:\",parseError);throw new Error(\"Invalid response from payment server\");}if(!response.ok){if(response.status===400){throw new Error(data.error||\"Invalid payment request\");}else if(response.status===402){throw new Error(data.error||\"Payment failed. Please check your M-Pesa balance and try again.\");}else if(response.status===422){throw new Error(data.error||\"Payment validation failed\");}else if(response.status===429){throw new Error(\"Too many payment attempts. Please try again in a few minutes.\");}else{throw new Error(data.error||\"Payment failed: \".concat(response.status));}}// Payment initiated successfully\nconsole.log(\"Payment initiated successfully:\",data);// Update local state to show \"Waiting for Admin Confirmation\"\nsetBookings(prevBookings=>prevBookings.map(booking=>booking.id===currentBooking.id?_objectSpread(_objectSpread({},booking),{},{payment_status:'pending'}):booking));// Show success message\nalert(\"Payment initiated successfully! Please check your phone to complete the M-Pesa transaction. Your payment status is now 'Waiting for Admin Confirmation'.\");closePaymentModal();// Start polling for payment status updates\nstartPaymentStatusPolling(currentBooking.id);}catch(error){console.error(\"Payment initiation error:\",error);setPaymentErrors({general:error.message||\"Failed to initiate payment. Please try again.\"});}finally{setProcessingPayment(prev=>_objectSpread(_objectSpread({},prev),{},{[currentBooking.id]:false}));}};// FIXED: Enhanced Payment Status Polling that properly detects admin updates\nconst startPaymentStatusPolling=bookingId=>{console.log(\"\\uD83D\\uDE80 Starting payment status polling for booking \".concat(bookingId));// Clear any existing interval for this booking\nif(pollingIntervals[bookingId]){clearInterval(pollingIntervals[bookingId]);}let retryCount=0;const maxRetries=360;// 30 minutes (360 * 5 seconds)\nconst interval=setInterval(async()=>{try{const storedUser=JSON.parse(localStorage.getItem(\"user\"));if(!(storedUser!==null&&storedUser!==void 0&&storedUser.token)){console.warn(\"User token not available, stopping polling\");clearInterval(interval);return;}const response=await fetch(\"\".concat(API_BASE_URL,\"/bookings/\").concat(bookingId),{headers:{Authorization:\"Bearer \".concat(storedUser.token)}});if(response.ok){const updatedBooking=await response.json();// FIX: Get current booking from state to compare\nconst currentBooking=bookings.find(b=>b.id===bookingId);const currentStatus=(currentBooking===null||currentBooking===void 0?void 0:currentBooking.payment_status)||'pending';const newStatus=updatedBooking.payment_status||'pending';console.log(\"\\uD83D\\uDCE1 Polling booking \".concat(bookingId,\":\"),{currentStatus,newStatus,retryCount});// If payment status changed from pending to something else (admin action)\nif(newStatus!==currentStatus&&currentStatus==='pending'&&newStatus!=='pending'){console.log(\"\\uD83C\\uDF89 Admin updated payment status for booking \".concat(bookingId,\":\"),{from:currentStatus,to:newStatus});clearInterval(interval);// Remove from polling intervals\nsetPollingIntervals(prev=>{const newIntervals=_objectSpread({},prev);delete newIntervals[bookingId];return newIntervals;});// Update the booking with the new status from backend\nsetBookings(prevBookings=>prevBookings.map(b=>b.id===bookingId?_objectSpread(_objectSpread({},b),{},{payment_status:newStatus}):b));// Show appropriate message based on new status\nif(newStatus==='partial_paid'){alert(\"✅ Partial payment confirmed! Thank you for your payment. The remaining balance will be due before check-in.\");}else if(newStatus==='payment_made'){alert(\"✅ Payment confirmed! Your booking is now fully paid. Thank you for your business!\");}}// If status is still pending, continue polling\nelse if(newStatus==='pending'){retryCount++;console.log(\"\\u23F3 Still waiting for admin confirmation for booking \".concat(bookingId,\", retry \").concat(retryCount));if(retryCount>=maxRetries){console.log(\"\\u23F9\\uFE0F Max retries reached for booking \".concat(bookingId,\", stopping polling\"));clearInterval(interval);setPollingIntervals(prev=>{const newIntervals=_objectSpread({},prev);delete newIntervals[bookingId];return newIntervals;});alert(\"⏳ Payment confirmation is taking longer than expected. Please check back later or contact support for updates.\");}}// If status changed but we're not in pending state (shouldn't happen normally)\nelse if(newStatus!==currentStatus){console.log(\"\\uD83D\\uDD04 Status changed for booking \".concat(bookingId,\":\"),{from:currentStatus,to:newStatus});// Update state anyway\nsetBookings(prevBookings=>prevBookings.map(b=>b.id===bookingId?_objectSpread(_objectSpread({},b),{},{payment_status:newStatus}):b));clearInterval(interval);setPollingIntervals(prev=>{const newIntervals=_objectSpread({},prev);delete newIntervals[bookingId];return newIntervals;});}}else{console.warn(\"Failed to fetch booking \".concat(bookingId,\" status: \").concat(response.status));retryCount++;}}catch(error){console.error(\"Error polling payment status:\",error);retryCount++;if(retryCount>=maxRetries){clearInterval(interval);setPollingIntervals(prev=>{const newIntervals=_objectSpread({},prev);delete newIntervals[bookingId];return newIntervals;});alert(\"⚠️ Unable to check payment status. Please refresh the page to check for updates.\");}}},5000);// Poll every 5 seconds\n// Store the interval\nsetPollingIntervals(prev=>_objectSpread(_objectSpread({},prev),{},{[bookingId]:interval}));};// Calculate total guests\nconst calculateTotalGuests=(adults,children)=>{return(parseInt(adults)||0)+(parseInt(children)||0);};// Generate PDF for booking\nconst generateBookingPDF=async booking=>{setGeneratingPDF(prev=>_objectSpread(_objectSpread({},prev),{},{[booking.id]:true}));try{const pdf=new jsPDF();const pageWidth=pdf.internal.pageSize.getWidth();const pageHeight=pdf.internal.pageSize.getHeight();// Add logo\nif(logo){pdf.addImage(logo,'PNG',pageWidth/2-25,15,50,20);}// Add title\npdf.setFontSize(20);pdf.setFont(\"helvetica\",\"bold\");pdf.text(\"My Bookings\",pageWidth/2,45,{align:\"center\"});// Add welcome message\npdf.setFontSize(12);pdf.setFont(\"helvetica\",\"normal\");pdf.text(\"Thank you for choosing our hotel! We are delighted to confirm your booking\",pageWidth/2,55,{align:\"center\"});pdf.text(\"and look forward to welcoming you. Below are your booking details:\",pageWidth/2,60,{align:\"center\"});// Booking details\nlet yPosition=80;pdf.setFontSize(14);pdf.setFont(\"helvetica\",\"bold\");pdf.text(\"Booking Confirmation: #\".concat(booking.id),20,yPosition);yPosition+=15;pdf.setFontSize(10);pdf.setFont(\"helvetica\",\"normal\");pdf.text(\"Room Type: \".concat(booking.room_type),20,yPosition);yPosition+=8;pdf.text(\"Check-in: \".concat(formatDate(booking.check_in)),20,yPosition);yPosition+=8;pdf.text(\"Check-out: \".concat(formatDate(booking.check_out)),20,yPosition);yPosition+=8;const priceDetails=calculateTotalPrice(booking);if(priceDetails){pdf.text(\"Duration: \".concat(priceDetails.numberOfNights,\" nights\"),20,yPosition);yPosition+=8;}const totalGuests=calculateTotalGuests(booking.adults,booking.children);pdf.text(\"Guests: \".concat(totalGuests,\" (\").concat(booking.adults||1,\" adults, \").concat(booking.children||0,\" children)\"),20,yPosition);yPosition+=8;pdf.text(\"Nationality: \".concat(booking.nationality||'Not specified'),20,yPosition);yPosition+=15;if(priceDetails){pdf.setFont(\"helvetica\",\"bold\");pdf.text(\"Price Breakdown:\",20,yPosition);yPosition+=8;pdf.setFont(\"helvetica\",\"normal\");pdf.text(\"Room Price: $\".concat(priceDetails.roomPriceUSD,\" USD (KES \").concat(priceDetails.roomPriceKES,\" per night)\"),20,yPosition);yPosition+=8;pdf.text(\"Total Nights: \".concat(priceDetails.numberOfNights),20,yPosition);yPosition+=8;if(parseInt(booking.children)>0){pdf.setTextColor(255,140,0);pdf.text(\"* Children charges to be discussed upon arrival\",20,yPosition);yPosition+=8;pdf.setTextColor(0,0,0);}pdf.setFont(\"helvetica\",\"bold\");pdf.text(\"Total Amount: KES \".concat(priceDetails.totalPriceKES),20,yPosition);yPosition+=15;}const paymentStatus=booking.payment_status||'pending';let statusColor=[0,0,0];let statusText='PENDING';if(paymentStatus==='partial_paid'){statusColor=[255,140,0];statusText='PARTIAL PAID';}else if(paymentStatus==='payment_made'){statusColor=[0,128,0];statusText='PAYMENT MADE';}else if(paymentStatus==='pending'){statusColor=[255,165,0];statusText='WAITING FOR ADMIN CONFIRMATION';}else{statusColor=[255,0,0];statusText='PENDING PAYMENT';}pdf.setTextColor(...statusColor);pdf.text(\"Payment Status: \".concat(statusText),20,yPosition);pdf.setTextColor(0,0,0);yPosition+=15;pdf.setFontSize(9);pdf.setTextColor(128,128,128);pdf.text(\"Booking created on: \".concat(new Date(booking.created_at).toLocaleDateString(\"en-US\",{year:\"numeric\",month:\"long\",day:\"numeric\",hour:\"2-digit\",minute:\"2-digit\"})),20,yPosition);yPosition+=10;pdf.text(\"Please present this confirmation at check-in. For any queries, contact our front desk.\",20,pageHeight-20);pdf.save(\"booking-confirmation-\".concat(booking.id,\".pdf\"));}catch(error){console.error(\"Error generating PDF:\",error);alert(\"Failed to generate PDF. Please try again.\");}finally{setGeneratingPDF(prev=>_objectSpread(_objectSpread({},prev),{},{[booking.id]:false}));}};// Helper function for payment status display\nconst getPaymentStatusDisplay=paymentStatus=>{switch(paymentStatus){case'pending':return{text:'Waiting for Admin Confirmation',color:'bg-orange-100 text-orange-800',icon:faClock};case'partial_paid':return{text:'Partial Paid',color:'bg-blue-100 text-blue-800',icon:faCheckCircle};case'payment_made':return{text:'Payment Made',color:'bg-green-100 text-green-800',icon:faCheckCircle};default:return{text:'Pending Payment',color:'bg-amber-100 text-amber-800',icon:faClock};}};// Enhanced Quick Amount Buttons\nconst quickAmountButtons=totalAmount=>[{label:\"25%\",value:Math.max(10,Math.round(totalAmount*0.25))},{label:\"50%\",value:Math.round(totalAmount*0.5)},{label:\"75%\",value:Math.round(totalAmount*0.75)},{label:\"Full Amount\",value:totalAmount}];// Calculate price details for current booking\nconst getCurrentBookingPriceDetails=()=>{if(!currentBooking)return null;return calculateTotalPrice(currentBooking);};// Enhanced Payment Modal Component with Fixed Issues\nconst PaymentModal=()=>{const currentBookingPriceDetails=getCurrentBookingPriceDetails();if(!showPaymentModal||!currentBooking||!currentBookingPriceDetails)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col border border-gray-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-6 border-b border-gray-200 bg-white\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold text-gray-900\",children:\"Make M-Pesa Payment\"}),/*#__PURE__*/_jsx(\"button\",{onClick:closePaymentModal,className:\"text-gray-400 hover:text-gray-600 transition-colors p-2 rounded-full hover:bg-gray-100\",disabled:processingPayment[currentBooking===null||currentBooking===void 0?void 0:currentBooking.id],children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faTimes,className:\"text-xl\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto p-6 space-y-6\",children:[paymentErrors.general&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 border border-red-200 rounded-xl p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faExclamationTriangle,className:\"text-red-500\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-700 font-medium\",children:paymentErrors.general})]})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold text-gray-800 mb-3\",children:\"M-Pesa Phone Number\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"absolute left-3 top-1/2 transform -translate-y-1/2 flex items-center gap-2 bg-gray-100 px-3 py-2 rounded-l-lg border-r border-gray-300\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700\",children:\"KE\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:\"+254\"})]}),/*#__PURE__*/_jsx(\"input\",{ref:phoneInputRef,type:\"tel\",inputMode:\"numeric\",placeholder:\"0722 123 456\",value:formatPhoneDisplay(phoneNumber),onChange:e=>handlePhoneNumberChange(e.target.value),disabled:processingPayment[currentBooking===null||currentBooking===void 0?void 0:currentBooking.id],className:\"w-full pl-24 pr-4 py-3 border rounded-xl focus:outline-none focus:ring-2 transition-colors \".concat(paymentErrors.phone?'border-red-300 focus:ring-red-500':'border-gray-300 focus:ring-green-500 focus:border-transparent',\" \").concat(processingPayment[currentBooking===null||currentBooking===void 0?void 0:currentBooking.id]?'bg-gray-100 cursor-not-allowed':'')})]}),paymentErrors.phone?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mt-2\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faExclamationTriangle,className:\"text-red-500 text-sm\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-600 text-sm font-medium\",children:paymentErrors.phone})]}):/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 text-xs mt-2\",children:\"Enter your Safaricom M-Pesa number. Examples: 0722 123 456, 254 722 123 456\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-semibold text-gray-800 mb-3\",children:\"Payment Amount\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute left-3 top-1/2 transform -translate-y-1/2\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-700 font-medium\",children:\"KES\"})}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",inputMode:\"decimal\",placeholder:\"Enter amount\",value:paymentAmount,onChange:e=>handleAmountChange(e.target.value),disabled:processingPayment[currentBooking===null||currentBooking===void 0?void 0:currentBooking.id],className:\"w-full pl-14 pr-4 py-3 border rounded-xl focus:outline-none focus:ring-2 transition-colors \".concat(paymentErrors.amount?'border-red-300 focus:ring-red-500':'border-gray-300 focus:ring-green-500 focus:border-transparent',\" \").concat(processingPayment[currentBooking===null||currentBooking===void 0?void 0:currentBooking.id]?'bg-gray-100 cursor-not-allowed':'')})]}),paymentErrors.amount&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mt-2\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faExclamationTriangle,className:\"text-red-500 text-sm\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-600 text-sm font-medium\",children:paymentErrors.amount})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-2 gap-3 mt-4\",children:quickAmountButtons(currentBookingPriceDetails.totalPriceKES).map((button,index)=>/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>setPaymentAmount(button.value.toString()),disabled:processingPayment[currentBooking===null||currentBooking===void 0?void 0:currentBooking.id],className:\"px-4 py-3 text-sm bg-gradient-to-r from-cyan-50 to-blue-50 hover:from-cyan-100 hover:to-blue-100 text-cyan-700 border border-cyan-200 rounded-xl transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed font-medium shadow-sm\",children:[button.label,/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-cyan-600 mt-1\",children:[\"KES \",button.value.toLocaleString()]})]},index))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-r from-cyan-50 to-blue-50 border border-cyan-200 rounded-xl p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-semibold text-cyan-800\",children:\"Total Booking Amount:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-lg font-bold text-cyan-600\",children:[\"KES \",currentBookingPriceDetails.totalPriceKES.toLocaleString()]})]}),parseFloat(paymentAmount)<currentBookingPriceDetails.totalPriceKES&&parseFloat(paymentAmount)>0&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-3 pt-3 border-t border-cyan-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center text-amber-600\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium\",children:\"Remaining Balance:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-bold\",children:[\"KES \",(currentBookingPriceDetails.totalPriceKES-parseFloat(paymentAmount)).toLocaleString()]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 border border-blue-200 rounded-xl p-4\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-semibold text-blue-800 mb-3 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard}),\"Payment Instructions:\"]}),/*#__PURE__*/_jsxs(\"ol\",{className:\"text-sm text-blue-700 space-y-2\",children:[/*#__PURE__*/_jsxs(\"li\",{className:\"flex items-start gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold mt-0.5\",children:\"1\"}),\"Enter your M-Pesa registered phone number\"]}),/*#__PURE__*/_jsxs(\"li\",{className:\"flex items-start gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold mt-0.5\",children:\"2\"}),\"Enter the payment amount or use quick buttons\"]}),/*#__PURE__*/_jsxs(\"li\",{className:\"flex items-start gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold mt-0.5\",children:\"3\"}),\"Click \\\"Pay KES Y\\\" to receive M-Pesa prompt\"]}),/*#__PURE__*/_jsxs(\"li\",{className:\"flex items-start gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold mt-0.5\",children:\"4\"}),\"Enter your M-Pesa PIN when prompted\"]}),/*#__PURE__*/_jsxs(\"li\",{className:\"flex items-start gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold mt-0.5\",children:\"5\"}),\"Wait for admin confirmation (status updates automatically)\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-4 p-6 border-t border-gray-200 bg-gray-50\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:closePaymentModal,disabled:processingPayment[currentBooking===null||currentBooking===void 0?void 0:currentBooking.id],className:\"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300 font-semibold disabled:opacity-50 disabled:cursor-not-allowed shadow-sm\",children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleMpesaPayment,disabled:processingPayment[currentBooking===null||currentBooking===void 0?void 0:currentBooking.id]||!phoneNumber||!paymentAmount,className:\"flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl hover:from-green-700 hover:to-green-800 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all duration-300 font-semibold flex items-center justify-center gap-2 shadow-lg hover:shadow-xl\",children:processingPayment[currentBooking===null||currentBooking===void 0?void 0:currentBooking.id]?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"}),\"Initiating...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard}),\"Pay KES \",parseFloat(paymentAmount||0).toLocaleString()]})})]})]})});};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 py-8 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-gray-600\",children:\"Loading your bookings...\"})]})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 py-8 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-lg border border-gray-200 p-8 text-center max-w-md\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faExclamationTriangle,className:\"text-red-600 text-2xl\"})}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-red-800 font-bold text-xl mb-2\",children:\"Error Loading Bookings\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-600 mb-6\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3 justify-center\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:fetchBookings,className:\"bg-cyan-600 hover:bg-cyan-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faSync}),\"Try Again\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>window.location.href=\"/\",className:\"bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faHome}),\"Go Home\"]})]})]})});}return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 py-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto px-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-4xl font-bold text-gray-900 mb-4\",children:\"My Bookings\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-lg\",children:\"Manage your reservations and payments in one place\"})]}),exchangeRate&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-8 bg-gradient-to-r from-cyan-50 to-blue-50 border border-cyan-200 rounded-2xl p-6 shadow-sm\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4 mb-4 sm:mb-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-cyan-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faReceipt,className:\"text-cyan-600 text-xl\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-cyan-800 font-semibold\",children:\"Current Exchange Rate\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-cyan-600\",children:[\"1 USD = \",exchangeRate,\" KES\"]})]})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:fetchExchangeRate,className:\"bg-cyan-600 hover:bg-cyan-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faSync}),\"Refresh Rate\"]})]})}),bookings.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-lg border border-gray-200 p-12 text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faReceipt,className:\"text-gray-400 text-3xl\"})}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold text-gray-900 mb-3\",children:\"No bookings yet\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-8 text-lg\",children:\"You haven't made any reservations yet.\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.href=\"/\",className:\"bg-cyan-600 hover:bg-cyan-700 text-white px-8 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl\",children:\"Book Now\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-6\",children:bookings.map(booking=>{const priceDetails=calculateTotalPrice(booking);const totalGuests=calculateTotalGuests(booking.adults,booking.children);const hasChildren=parseInt(booking.children)>0;const paymentStatus=booking.payment_status||'not_paid';const isProcessing=processingPayment[booking.id];const hasRoomPrice=roomPrices[booking.room_type];const isGeneratingPDF=generatingPDF[booking.id];const paymentStatusDisplay=getPaymentStatusDisplay(paymentStatus);const isPaid=paymentStatus==='partial_paid'||paymentStatus==='payment_made';const isWaitingForAdmin=paymentStatus==='pending';const isNotPaid=paymentStatus==='not_paid'||!paymentStatus;return/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden transition-all duration-300 hover:shadow-xl\",children:/*#__PURE__*/_jsx(\"div\",{className:\"p-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row sm:items-center justify-between mb-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold text-gray-900 mb-2 sm:mb-0\",children:booking.room_type}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[getStatusBadge(booking.check_in,booking.check_out),/*#__PURE__*/_jsxs(\"span\",{className:\"\".concat(paymentStatusDisplay.color,\" text-xs font-medium px-3 py-1 rounded-full flex items-center gap-2\"),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:paymentStatusDisplay.icon,className:\"text-xs\"}),paymentStatusDisplay.text]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-500\",children:\"Booking ID: \"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-semibold text-cyan-600\",children:[\"#\",booking.id]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 rounded-xl p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-cyan-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCalendarDay,className:\"text-cyan-600 text-sm\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-900\",children:\"Check-in\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:formatDate(booking.check_in)})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 rounded-xl p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-cyan-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCalendarDay,className:\"text-cyan-600 text-sm\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-900\",children:\"Check-out\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:formatDate(booking.check_out)})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 rounded-xl p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-cyan-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faReceipt,className:\"text-cyan-600 text-sm\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-900\",children:\"Guests\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-gray-600\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"block\",children:[\"Adults: \",booking.adults||1]}),/*#__PURE__*/_jsxs(\"span\",{className:\"block\",children:[\"Children: \",booking.children||0]}),/*#__PURE__*/_jsxs(\"span\",{className:\"block font-medium mt-1\",children:[\"Total: \",totalGuests]})]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 rounded-xl p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-cyan-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faReceipt,className:\"text-cyan-600 text-sm\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-900\",children:\"Nationality\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:booking.nationality||'Not specified'})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-gray-900\",children:\"Stay Duration: \"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-cyan-600 font-semibold\",children:[priceDetails?priceDetails.numberOfNights:'Calculating...',\" nights\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 pt-6 border-t border-gray-200\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-bold text-gray-900 mb-4 text-lg\",children:\"Price Breakdown\"}),loadingRoomPrices||loadingExchangeRate?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500 mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mt-3 font-medium\",children:loadingRoomPrices?'Loading room prices...':'Fetching exchange rate...'})]}):!hasRoomPrice||!exchangeRate?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-6 bg-amber-50 rounded-xl p-4\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faExclamationTriangle,className:\"text-amber-600 text-2xl mb-3\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-amber-700 font-medium mb-4\",children:!hasRoomPrice?'Awaiting response from server for room prices':'Unable to fetch exchange rate'}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3 justify-center\",children:[!hasRoomPrice&&/*#__PURE__*/_jsx(\"button\",{onClick:fetchRoomPrices,className:\"bg-amber-500 hover:bg-amber-600 text-white px-5 py-2 rounded-xl font-semibold transition-all duration-300\",children:\"Retry Room Prices\"}),!exchangeRate&&/*#__PURE__*/_jsx(\"button\",{onClick:fetchExchangeRate,className:\"bg-amber-500 hover:bg-amber-600 text-white px-5 py-2 rounded-xl font-semibold transition-all duration-300\",children:\"Retry Exchange Rate\"})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-r from-cyan-50 to-blue-50 rounded-2xl p-6 space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-700\",children:\"Room price (USD):\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold\",children:[\"$\",priceDetails.roomPriceUSD,\" per night\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center text-green-600\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Converted to KES:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold\",children:[\"KES \",priceDetails.roomPriceKES,\" per night\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Duration:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold\",children:[priceDetails.numberOfNights,\" nights\"]})]}),hasChildren&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center bg-amber-100 rounded-xl p-4\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-amber-700\",children:\"Children charges:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-amber-700\",children:\"To be discussed upon arrival\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center pt-4 border-t border-cyan-200\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-xl font-bold text-gray-900\",children:\"Total Price (KES):\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-2xl font-bold text-cyan-600\",children:[\"KES \",priceDetails.totalPriceKES]})]}),hasChildren&&/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-amber-600 mt-2\",children:\"* Final total may vary based on children charges discussed at check-in\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 text-sm text-gray-500\",children:[\"Booked on: \",new Date(booking.created_at).toLocaleDateString(\"en-US\",{year:\"numeric\",month:\"long\",day:\"numeric\",hour:\"2-digit\",minute:\"2-digit\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"lg:w-64 flex flex-col space-y-4\",children:[!hasRoomPrice||!exchangeRate||loadingRoomPrices||loadingExchangeRate?/*#__PURE__*/_jsx(\"button\",{disabled:true,className:\"w-full px-6 py-4 bg-gray-300 text-gray-500 rounded-xl font-semibold cursor-not-allowed\",children:loadingRoomPrices||loadingExchangeRate?'Loading...':'Awaiting Price Information'}):isNotPaid?/*#__PURE__*/// Not paid state - show payment button\n_jsx(\"button\",{onClick:()=>openPaymentModal(booking,priceDetails.totalPriceKES),disabled:isProcessing,className:\"w-full px-6 py-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-3 \".concat(isProcessing?'bg-gray-400 text-gray-200 cursor-not-allowed':'bg-green-600 hover:bg-green-700 text-white shadow-lg hover:shadow-xl'),children:isProcessing?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"}),\"Initiating...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCreditCard}),\"Pay KES \",priceDetails.totalPriceKES]})}):isWaitingForAdmin?/*#__PURE__*/// Waiting for admin confirmation state - show disabled button\n_jsxs(\"button\",{disabled:true,className:\"w-full px-6 py-4 bg-orange-100 text-orange-800 rounded-xl font-semibold cursor-not-allowed flex items-center justify-center gap-3\",children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faClock}),\"Waiting for Admin Confirmation\"]}):isPaid?/*#__PURE__*/// Paid state - show appropriate paid button (disabled)\n_jsxs(\"button\",{disabled:true,className:\"w-full px-6 py-4 rounded-xl font-semibold cursor-not-allowed flex items-center justify-center gap-3 \".concat(paymentStatus==='partial_paid'?'bg-blue-100 text-blue-800':'bg-green-100 text-green-800'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faCheckCircle}),paymentStatus==='partial_paid'?'Partial Payment Made':'Payment Made']}):null,/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleCancelBooking(booking.id),disabled:isWaitingForAdmin||isPaid,className:\"w-full px-6 py-4 border rounded-xl font-semibold transition-all duration-300 flex items-center justify-center gap-3 \".concat(isWaitingForAdmin||isPaid?'border-gray-300 text-gray-400 bg-gray-100 cursor-not-allowed':'border-red-300 text-red-600 hover:bg-red-50 hover:scale-105'),children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faTimes}),isWaitingForAdmin||isPaid?'Cancellation Not Available':'Cancel Booking']}),isPaid&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>generateBookingPDF(booking),disabled:isGeneratingPDF,className:\"w-full px-6 py-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-3 \".concat(isGeneratingPDF?'bg-gray-400 text-gray-200 cursor-not-allowed':'bg-cyan-600 hover:bg-cyan-700 text-white shadow-lg hover:shadow-xl'),children:isGeneratingPDF?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"}),\"Generating...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faDownload}),\"Download PDF\"]})})]})]})})},booking.id);})}),/*#__PURE__*/_jsx(PaymentModal,{})]})});}","map":{"version":3,"names":["React","useState","useEffect","useRef","jsPDF","logo","FontAwesomeIcon","faDownload","faTimes","faCreditCard","faSync","faHome","faExclamationTriangle","faCheckCircle","faClock","faReceipt","faCalendarDay","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MyBookings","bookings","setBookings","loading","setLoading","error","setError","roomPrices","setRoomPrices","processingPayment","setProcessingPayment","loadingRoomPrices","setLoadingRoomPrices","exchangeRate","setExchangeRate","loadingExchangeRate","setLoadingExchangeRate","generatingPDF","setGeneratingPDF","pollingIntervals","setPollingIntervals","showPaymentModal","setShowPaymentModal","currentBooking","setCurrentBooking","paymentAmount","setPaymentAmount","phoneNumber","setPhoneNumber","paymentErrors","setPaymentErrors","phoneInputRef","API_BASE_URL","process","env","REACT_APP_API_BASE_URL","fetchBookings","fetchRoomPrices","fetchExchangeRate","Object","values","forEach","interval","clearInterval","response","fetch","ok","Error","data","json","kesRate","rates","KES","console","warn","concat","roomTypes","prices","room","name","price","storedUser","JSON","parse","localStorage","getItem","token","method","headers","Authorization","responseText","text","parseError","status","message","bookingsData","Array","isArray","booking","payment_status","id","log","startPaymentStatusPolling","err","includes","formatDate","dateString","Date","toLocaleDateString","year","month","day","getStatusBadge","checkIn","checkOut","today","checkInDate","checkOutDate","className","children","convertToKES","usdAmount","Math","round","calculateTotalPrice","roomPriceUSD","room_type","roomPriceKES","numberOfNights","ceil","check_out","check_in","totalPriceKES","pricePerNightKES","handleCancelBooking","bookingId","window","confirm","alert","validatePhoneNumber","phone","cleanPhone","replace","phoneRegex","match","isValid","formattedPhone","formatPhoneDisplay","startsWith","length","slice","handlePhoneNumberChange","value","_phoneInputRef$curren","cursorPosition","current","selectionStart","digitsOnly","formatted","prev","_objectSpread","setTimeout","newCursorPosition","min","setSelectionRange","validatePaymentAmount","amount","maxAmount","numAmount","parseFloat","isNaN","toLocaleString","handleAmountChange","cleanValue","parts","split","openPaymentModal","totalAmount","toString","closePaymentModal","handleMpesaPayment","phoneValidation","currentBookingPriceDetails","getCurrentBookingPriceDetails","amountValidation","paymentData","payment","body","stringify","prevBookings","map","general","retryCount","maxRetries","setInterval","updatedBooking","find","b","currentStatus","newStatus","from","to","newIntervals","calculateTotalGuests","adults","parseInt","generateBookingPDF","pdf","pageWidth","internal","pageSize","getWidth","pageHeight","getHeight","addImage","setFontSize","setFont","align","yPosition","priceDetails","totalGuests","nationality","setTextColor","paymentStatus","statusColor","statusText","created_at","hour","minute","save","getPaymentStatusDisplay","color","icon","quickAmountButtons","label","max","PaymentModal","onClick","disabled","ref","type","inputMode","placeholder","onChange","e","target","button","index","location","href","hasChildren","isProcessing","hasRoomPrice","isGeneratingPDF","paymentStatusDisplay","isPaid","isWaitingForAdmin","isNotPaid"],"sources":["/root/southcoastwebmain/src/Components/MyBookings.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport jsPDF from \"jspdf\";\nimport logo from \"./images/IMG-20251008-WA0008logo0.png\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faDownload, faTimes, faCreditCard, faSync, faHome, faExclamationTriangle, faCheckCircle, faClock, faReceipt, faCalendarDay } from \"@fortawesome/free-solid-svg-icons\";\n\nexport default function MyBookings() {\n  const [bookings, setBookings] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [roomPrices, setRoomPrices] = useState({});\n  const [processingPayment, setProcessingPayment] = useState({});\n  const [loadingRoomPrices, setLoadingRoomPrices] = useState(true);\n  const [exchangeRate, setExchangeRate] = useState(null);\n  const [loadingExchangeRate, setLoadingExchangeRate] = useState(true);\n  const [generatingPDF, setGeneratingPDF] = useState({});\n  const [pollingIntervals, setPollingIntervals] = useState({});\n  const [showPaymentModal, setShowPaymentModal] = useState(false);\n  const [currentBooking, setCurrentBooking] = useState(null);\n  const [paymentAmount, setPaymentAmount] = useState(\"\");\n  const [phoneNumber, setPhoneNumber] = useState(\"\");\n  const [paymentErrors, setPaymentErrors] = useState({});\n  const phoneInputRef = useRef(null);\n\n  // Production API base URL\n  const API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://127.0.0.1:3000/api/v1';\n\n  useEffect(() => {\n    fetchBookings();\n    fetchRoomPrices();\n    fetchExchangeRate();\n    \n    return () => {\n      Object.values(pollingIntervals).forEach(interval => clearInterval(interval));\n    };\n  }, []);\n\n  // Fetch exchange rate\n  const fetchExchangeRate = async () => {\n    try {\n      setLoadingExchangeRate(true);\n      const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch exchange rate');\n      }\n      \n      const data = await response.json();\n      const kesRate = data.rates.KES;\n      \n      if (!kesRate) {\n        throw new Error('KES rate not available');\n      }\n      \n      setExchangeRate(kesRate);\n    } catch (error) {\n      console.warn(\"Using fallback exchange rate:\", error);\n      setExchangeRate(130);\n    } finally {\n      setLoadingExchangeRate(false);\n    }\n  };\n\n  // Fetch room prices\n  const fetchRoomPrices = async () => {\n    try {\n      setLoadingRoomPrices(true);\n      const response = await fetch(`${API_BASE_URL}/room_types`);\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch room prices');\n      }\n      \n      const roomTypes = await response.json();\n      const prices = {};\n      roomTypes.forEach(room => {\n        prices[room.name] = room.price;\n      });\n      setRoomPrices(prices);\n    } catch (error) {\n      console.error(\"Error fetching room prices:\", error);\n      setError(\"Awaiting response from server for room prices\");\n    } finally {\n      setLoadingRoomPrices(false);\n    }\n  };\n\n  const fetchBookings = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const storedUser = JSON.parse(localStorage.getItem(\"user\"));\n      if (!storedUser?.token) {\n        setError(\"Please log in to view your bookings\");\n        setLoading(false);\n        return;\n      }\n\n      const response = await fetch(`${API_BASE_URL}/bookings`, {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${storedUser.token}`,\n        },\n      });\n\n      const responseText = await response.text();\n      let data;\n\n      try {\n        data = JSON.parse(responseText);\n      } catch (parseError) {\n        console.error(\"JSON Parse Error:\", parseError);\n        throw new Error(\"Server returned an invalid response. Please check if the backend is running properly.\");\n      }\n\n      if (!response.ok) {\n        if (response.status === 401) setError(\"Unauthorized. Please log in again.\");\n        else throw new Error(data.error || data.message || `Failed to fetch bookings: ${response.status}`);\n        setLoading(false);\n        return;\n      }\n\n      const bookingsData = Array.isArray(data) ? data : [];\n      setBookings(bookingsData);\n\n      // FIX: Restart polling for any bookings that are still pending\n      bookingsData.forEach(booking => {\n        if (booking.payment_status === 'pending' && !pollingIntervals[booking.id]) {\n          console.log(`🔄 Restarting polling for booking ${booking.id}`);\n          startPaymentStatusPolling(booking.id);\n        }\n      });\n\n    } catch (err) {\n      console.error(\"Error fetching bookings:\", err);\n      \n      if (err.message.includes(\"Failed to fetch\")) {\n        setError(\"Cannot connect to server. Please check your internet connection.\");\n      } else if (err.message.includes(\"Server returned an invalid response\")) {\n        setError(\"Server error: The backend is not responding properly. Please try again later.\");\n      } else {\n        setError(err.message || \"Failed to load bookings\");\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const formatDate = (dateString) =>\n    new Date(dateString).toLocaleDateString(\"en-US\", {\n      year: \"numeric\",\n      month: \"long\",\n      day: \"numeric\",\n    });\n\n  const getStatusBadge = (checkIn, checkOut) => {\n    const today = new Date();\n    const checkInDate = new Date(checkIn);\n    const checkOutDate = new Date(checkOut);\n\n    if (today < checkInDate)\n      return <span className=\"bg-blue-100 text-blue-800 text-xs font-medium px-3 py-1 rounded-full\">Upcoming</span>;\n    else if (today >= checkInDate && today <= checkOutDate)\n      return <span className=\"bg-green-100 text-green-800 text-xs font-medium px-3 py-1 rounded-full\">Active</span>;\n    else\n      return <span className=\"bg-gray-100 text-gray-800 text-xs font-medium px-3 py-1 rounded-full\">Completed</span>;\n  };\n\n  // Convert USD to KES\n  const convertToKES = (usdAmount) => {\n    if (!exchangeRate || !usdAmount) return 0;\n    return Math.round(usdAmount * exchangeRate);\n  };\n\n  // Calculate total price\n  const calculateTotalPrice = (booking) => {\n    const roomPriceUSD = roomPrices[booking.room_type];\n    if (!roomPriceUSD) return null;\n\n    const roomPriceKES = convertToKES(roomPriceUSD);\n    const numberOfNights = Math.ceil((new Date(booking.check_out) - new Date(booking.check_in)) / (1000 * 60 * 60 * 24));\n    const totalPriceKES = roomPriceKES * numberOfNights;\n    \n    return {\n      roomPriceUSD,\n      roomPriceKES,\n      numberOfNights,\n      totalPriceKES,\n      pricePerNightKES: roomPriceKES\n    };\n  };\n\n  const handleCancelBooking = async (bookingId) => {\n    if (!window.confirm(\"Are you sure you want to cancel this booking? This action cannot be undone.\")) return;\n\n    try {\n      const storedUser = JSON.parse(localStorage.getItem(\"user\"));\n      const response = await fetch(`${API_BASE_URL}/bookings/${bookingId}`, {\n        method: \"DELETE\",\n        headers: {\n          Authorization: `Bearer ${storedUser.token}`,\n        },\n      });\n\n      const responseText = await response.text();\n      let data;\n\n      try {\n        data = JSON.parse(responseText);\n      } catch (parseError) {\n        console.error(\"JSON Parse Error:\", parseError);\n        throw new Error(\"Server returned an invalid response. Please check if the backend is running properly.\");\n      }\n\n      if (response.ok) {\n        alert(\"Booking cancelled successfully! Cancellation emails have been sent to you and the admin.\");\n        fetchBookings();\n      } else {\n        throw new Error(data.error || data.message || \"Failed to cancel booking\");\n      }\n    } catch (err) {\n      console.error(\"Error cancelling booking:\", err);\n      \n      if (err.message.includes(\"Failed to fetch\")) {\n        alert(\"Cannot connect to server. Please check your internet connection.\");\n      } else if (err.message.includes(\"Server returned an invalid response\")) {\n        alert(\"Server error: The backend is not responding properly. Please try again later.\");\n      } else {\n        alert(\"Failed to cancel booking. Please try again.\");\n      }\n    }\n  };\n\n  // Enhanced Phone Number Validation with Better Formatting\n  const validatePhoneNumber = (phone) => {\n    const cleanPhone = phone.replace(/\\D/g, '');\n    const phoneRegex = /^(?:254|\\+254|0)?(7[0-9]{8})$/;\n    const match = cleanPhone.match(phoneRegex);\n    \n    if (!match) {\n      return { isValid: false, error: \"Please enter a valid Kenyan phone number starting with 07 or 254\" };\n    }\n    \n    const formattedPhone = `254${match[1]}`;\n    \n    return { \n      isValid: true, \n      formattedPhone,\n      error: null \n    };\n  };\n\n  // Enhanced Phone Number Formatting for Display\n  const formatPhoneDisplay = (phone) => {\n    const cleanPhone = phone.replace(/\\D/g, '');\n    \n    if (cleanPhone.startsWith('254') && cleanPhone.length === 12) {\n      return `254 ${cleanPhone.slice(3, 6)} ${cleanPhone.slice(6, 9)} ${cleanPhone.slice(9)}`;\n    } else if (cleanPhone.startsWith('0') && cleanPhone.length === 10) {\n      return `${cleanPhone.slice(0, 4)} ${cleanPhone.slice(4, 7)} ${cleanPhone.slice(7)}`;\n    } else if (cleanPhone.startsWith('7') && cleanPhone.length === 9) {\n      return `0${cleanPhone.slice(0, 3)} ${cleanPhone.slice(3, 6)} ${cleanPhone.slice(6)}`;\n    }\n    \n    return phone;\n  };\n\n  // FIXED: Enhanced Phone Number Input Handler - No more single digit issue\n  const handlePhoneNumberChange = (value) => {\n    // Store current cursor position\n    const cursorPosition = phoneInputRef.current?.selectionStart || 0;\n    \n    // Remove all non-digits\n    const digitsOnly = value.replace(/\\D/g, '');\n    \n    let formatted = digitsOnly;\n    \n    // Handle different starting formats\n    if (digitsOnly.startsWith('0') && digitsOnly.length <= 10) {\n      formatted = digitsOnly;\n    } else if (digitsOnly.startsWith('254') && digitsOnly.length <= 12) {\n      formatted = digitsOnly;\n    } else if (digitsOnly.startsWith('7') && digitsOnly.length <= 9) {\n      formatted = `0${digitsOnly}`;\n    } else if (digitsOnly.length > 0) {\n      formatted = `0${digitsOnly.slice(-9)}`;\n    }\n    \n    // Limit length based on format\n    if (formatted.length > (formatted.startsWith('254') ? 12 : 10)) {\n      formatted = formatted.slice(0, formatted.startsWith('254') ? 12 : 10);\n    }\n    \n    setPhoneNumber(formatted);\n    \n    // Clear phone errors when user starts typing\n    if (paymentErrors.phone) {\n      setPaymentErrors(prev => ({ ...prev, phone: null }));\n    }\n\n    // Restore cursor position after state update\n    setTimeout(() => {\n      if (phoneInputRef.current) {\n        const newCursorPosition = Math.min(cursorPosition, formatted.length);\n        phoneInputRef.current.setSelectionRange(newCursorPosition, newCursorPosition);\n      }\n    }, 0);\n  };\n\n  // Payment amount validation\n  const validatePaymentAmount = (amount, maxAmount) => {\n    const numAmount = parseFloat(amount);\n    \n    if (isNaN(numAmount) || numAmount <= 0) {\n      return { isValid: false, error: \"Please enter a valid payment amount\" };\n    }\n    \n    if (numAmount > maxAmount) {\n      return { \n        isValid: false, \n        error: `Payment amount cannot exceed KES ${maxAmount.toLocaleString()}` \n      };\n    }\n    \n    if (numAmount < 10) {\n      return { \n        isValid: false, \n        error: \"Minimum payment amount is KES 10\" \n      };\n    }\n    \n    return { isValid: true, error: null };\n  };\n\n  // Enhanced Amount Input Handler\n  const handleAmountChange = (value) => {\n    // Only allow numbers and decimal point\n    const cleanValue = value.replace(/[^\\d.]/g, '');\n    \n    // Ensure only one decimal point\n    const parts = cleanValue.split('.');\n    if (parts.length > 2) {\n      return;\n    }\n    \n    // Limit decimal places to 2\n    if (parts[1] && parts[1].length > 2) {\n      return;\n    }\n    \n    setPaymentAmount(cleanValue);\n    \n    if (paymentErrors.amount) {\n      setPaymentErrors(prev => ({ ...prev, amount: null }));\n    }\n  };\n\n  // Open payment modal\n  const openPaymentModal = (booking, totalAmount) => {\n    setCurrentBooking(booking);\n    setPaymentAmount(totalAmount.toString());\n    setPhoneNumber(\"\");\n    setPaymentErrors({});\n    setShowPaymentModal(true);\n  };\n\n  // Close payment modal\n  const closePaymentModal = () => {\n    setShowPaymentModal(false);\n    setCurrentBooking(null);\n    setPaymentAmount(\"\");\n    setPhoneNumber(\"\");\n    setPaymentErrors({});\n  };\n\n  // FIXED: Handle M-Pesa payment with corrected parameters\n  const handleMpesaPayment = async () => {\n    if (!currentBooking) return;\n\n    setPaymentErrors({});\n    \n    // Validate phone number\n    const phoneValidation = validatePhoneNumber(phoneNumber);\n    if (!phoneValidation.isValid) {\n      setPaymentErrors({ phone: phoneValidation.error });\n      return;\n    }\n\n    // Validate payment amount\n    const currentBookingPriceDetails = getCurrentBookingPriceDetails();\n    if (!currentBookingPriceDetails) {\n      setPaymentErrors({ amount: \"Unable to calculate booking amount\" });\n      return;\n    }\n\n    const amountValidation = validatePaymentAmount(\n      paymentAmount, \n      currentBookingPriceDetails.totalPriceKES\n    );\n    \n    if (!amountValidation.isValid) {\n      setPaymentErrors({ amount: amountValidation.error });\n      return;\n    }\n\n    setProcessingPayment(prev => ({ ...prev, [currentBooking.id]: true }));\n    \n    try {\n      const storedUser = JSON.parse(localStorage.getItem(\"user\"));\n      \n      if (!storedUser?.token) {\n        throw new Error(\"Authentication required. Please log in again.\");\n      }\n\n      // FIXED: Remove unpermitted parameters that were causing server warnings\n      const paymentData = {\n        payment: {\n          phone: phoneValidation.formattedPhone,\n          amount: parseFloat(paymentAmount)\n        }\n      };\n\n      console.log(\"Initiating M-Pesa payment:\", paymentData);\n\n      const response = await fetch(`${API_BASE_URL}/bookings/${currentBooking.id}/payments`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${storedUser.token}`,\n        },\n        body: JSON.stringify(paymentData),\n      });\n\n      const responseText = await response.text();\n      let data;\n\n      try {\n        data = JSON.parse(responseText);\n      } catch (parseError) {\n        console.error(\"JSON Parse Error:\", parseError);\n        throw new Error(\"Invalid response from payment server\");\n      }\n\n      if (!response.ok) {\n        if (response.status === 400) {\n          throw new Error(data.error || \"Invalid payment request\");\n        } else if (response.status === 402) {\n          throw new Error(data.error || \"Payment failed. Please check your M-Pesa balance and try again.\");\n        } else if (response.status === 422) {\n          throw new Error(data.error || \"Payment validation failed\");\n        } else if (response.status === 429) {\n          throw new Error(\"Too many payment attempts. Please try again in a few minutes.\");\n        } else {\n          throw new Error(data.error || `Payment failed: ${response.status}`);\n        }\n      }\n\n      // Payment initiated successfully\n      console.log(\"Payment initiated successfully:\", data);\n\n      // Update local state to show \"Waiting for Admin Confirmation\"\n      setBookings(prevBookings => \n        prevBookings.map(booking => \n          booking.id === currentBooking.id \n            ? { ...booking, payment_status: 'pending' }\n            : booking\n        )\n      );\n\n      // Show success message\n      alert(\"Payment initiated successfully! Please check your phone to complete the M-Pesa transaction. Your payment status is now 'Waiting for Admin Confirmation'.\");\n      \n      closePaymentModal();\n      \n      // Start polling for payment status updates\n      startPaymentStatusPolling(currentBooking.id);\n      \n    } catch (error) {\n      console.error(\"Payment initiation error:\", error);\n      setPaymentErrors({ \n        general: error.message || \"Failed to initiate payment. Please try again.\" \n      });\n    } finally {\n      setProcessingPayment(prev => ({ ...prev, [currentBooking.id]: false }));\n    }\n  };\n\n  // FIXED: Enhanced Payment Status Polling that properly detects admin updates\n  const startPaymentStatusPolling = (bookingId) => {\n    console.log(`🚀 Starting payment status polling for booking ${bookingId}`);\n    \n    // Clear any existing interval for this booking\n    if (pollingIntervals[bookingId]) {\n      clearInterval(pollingIntervals[bookingId]);\n    }\n\n    let retryCount = 0;\n    const maxRetries = 360; // 30 minutes (360 * 5 seconds)\n\n    const interval = setInterval(async () => {\n      try {\n        const storedUser = JSON.parse(localStorage.getItem(\"user\"));\n        if (!storedUser?.token) {\n          console.warn(\"User token not available, stopping polling\");\n          clearInterval(interval);\n          return;\n        }\n\n        const response = await fetch(`${API_BASE_URL}/bookings/${bookingId}`, {\n          headers: {\n            Authorization: `Bearer ${storedUser.token}`,\n          },\n        });\n\n        if (response.ok) {\n          const updatedBooking = await response.json();\n          \n          // FIX: Get current booking from state to compare\n          const currentBooking = bookings.find(b => b.id === bookingId);\n          const currentStatus = currentBooking?.payment_status || 'pending';\n          const newStatus = updatedBooking.payment_status || 'pending';\n          \n          console.log(`📡 Polling booking ${bookingId}:`, {\n            currentStatus,\n            newStatus, \n            retryCount\n          });\n          \n          // If payment status changed from pending to something else (admin action)\n          if (newStatus !== currentStatus && currentStatus === 'pending' && newStatus !== 'pending') {\n            console.log(`🎉 Admin updated payment status for booking ${bookingId}:`, { \n              from: currentStatus, \n              to: newStatus \n            });\n            \n            clearInterval(interval);\n            \n            // Remove from polling intervals\n            setPollingIntervals(prev => {\n              const newIntervals = { ...prev };\n              delete newIntervals[bookingId];\n              return newIntervals;\n            });\n            \n            // Update the booking with the new status from backend\n            setBookings(prevBookings => \n              prevBookings.map(b => \n                b.id === bookingId \n                  ? { ...b, payment_status: newStatus }\n                  : b\n              )\n            );\n            \n            // Show appropriate message based on new status\n            if (newStatus === 'partial_paid') {\n              alert(\"✅ Partial payment confirmed! Thank you for your payment. The remaining balance will be due before check-in.\");\n            } else if (newStatus === 'payment_made') {\n              alert(\"✅ Payment confirmed! Your booking is now fully paid. Thank you for your business!\");\n            }\n          } \n          // If status is still pending, continue polling\n          else if (newStatus === 'pending') {\n            retryCount++;\n            console.log(`⏳ Still waiting for admin confirmation for booking ${bookingId}, retry ${retryCount}`);\n            \n            if (retryCount >= maxRetries) {\n              console.log(`⏹️ Max retries reached for booking ${bookingId}, stopping polling`);\n              clearInterval(interval);\n              setPollingIntervals(prev => {\n                const newIntervals = { ...prev };\n                delete newIntervals[bookingId];\n                return newIntervals;\n              });\n              \n              alert(\"⏳ Payment confirmation is taking longer than expected. Please check back later or contact support for updates.\");\n            }\n          }\n          // If status changed but we're not in pending state (shouldn't happen normally)\n          else if (newStatus !== currentStatus) {\n            console.log(`🔄 Status changed for booking ${bookingId}:`, { from: currentStatus, to: newStatus });\n            \n            // Update state anyway\n            setBookings(prevBookings => \n              prevBookings.map(b => \n                b.id === bookingId \n                  ? { ...b, payment_status: newStatus }\n                  : b\n              )\n            );\n            \n            clearInterval(interval);\n            setPollingIntervals(prev => {\n              const newIntervals = { ...prev };\n              delete newIntervals[bookingId];\n              return newIntervals;\n            });\n          }\n        } else {\n          console.warn(`Failed to fetch booking ${bookingId} status: ${response.status}`);\n          retryCount++;\n        }\n      } catch (error) {\n        console.error(\"Error polling payment status:\", error);\n        retryCount++;\n        \n        if (retryCount >= maxRetries) {\n          clearInterval(interval);\n          setPollingIntervals(prev => {\n            const newIntervals = { ...prev };\n            delete newIntervals[bookingId];\n            return newIntervals;\n          });\n          \n          alert(\"⚠️ Unable to check payment status. Please refresh the page to check for updates.\");\n        }\n      }\n    }, 5000); // Poll every 5 seconds\n\n    // Store the interval\n    setPollingIntervals(prev => ({ \n      ...prev, \n      [bookingId]: interval \n    }));\n  };\n\n  // Calculate total guests\n  const calculateTotalGuests = (adults, children) => {\n    return (parseInt(adults) || 0) + (parseInt(children) || 0);\n  };\n\n  // Generate PDF for booking\n  const generateBookingPDF = async (booking) => {\n    setGeneratingPDF(prev => ({ ...prev, [booking.id]: true }));\n    \n    try {\n      const pdf = new jsPDF();\n      const pageWidth = pdf.internal.pageSize.getWidth();\n      const pageHeight = pdf.internal.pageSize.getHeight();\n      \n      // Add logo\n      if (logo) {\n        pdf.addImage(logo, 'PNG', pageWidth / 2 - 25, 15, 50, 20);\n      }\n      \n      // Add title\n      pdf.setFontSize(20);\n      pdf.setFont(\"helvetica\", \"bold\");\n      pdf.text(\"My Bookings\", pageWidth / 2, 45, { align: \"center\" });\n      \n      // Add welcome message\n      pdf.setFontSize(12);\n      pdf.setFont(\"helvetica\", \"normal\");\n      pdf.text(\"Thank you for choosing our hotel! We are delighted to confirm your booking\", pageWidth / 2, 55, { align: \"center\" });\n      pdf.text(\"and look forward to welcoming you. Below are your booking details:\", pageWidth / 2, 60, { align: \"center\" });\n      \n      // Booking details\n      let yPosition = 80;\n      \n      pdf.setFontSize(14);\n      pdf.setFont(\"helvetica\", \"bold\");\n      pdf.text(`Booking Confirmation: #${booking.id}`, 20, yPosition);\n      \n      yPosition += 15;\n      pdf.setFontSize(10);\n      pdf.setFont(\"helvetica\", \"normal\");\n      \n      pdf.text(`Room Type: ${booking.room_type}`, 20, yPosition);\n      yPosition += 8;\n      \n      pdf.text(`Check-in: ${formatDate(booking.check_in)}`, 20, yPosition);\n      yPosition += 8;\n      pdf.text(`Check-out: ${formatDate(booking.check_out)}`, 20, yPosition);\n      yPosition += 8;\n      \n      const priceDetails = calculateTotalPrice(booking);\n      if (priceDetails) {\n        pdf.text(`Duration: ${priceDetails.numberOfNights} nights`, 20, yPosition);\n        yPosition += 8;\n      }\n      \n      const totalGuests = calculateTotalGuests(booking.adults, booking.children);\n      pdf.text(`Guests: ${totalGuests} (${booking.adults || 1} adults, ${booking.children || 0} children)`, 20, yPosition);\n      yPosition += 8;\n      \n      pdf.text(`Nationality: ${booking.nationality || 'Not specified'}`, 20, yPosition);\n      yPosition += 15;\n      \n      if (priceDetails) {\n        pdf.setFont(\"helvetica\", \"bold\");\n        pdf.text(\"Price Breakdown:\", 20, yPosition);\n        yPosition += 8;\n        pdf.setFont(\"helvetica\", \"normal\");\n        \n        pdf.text(`Room Price: $${priceDetails.roomPriceUSD} USD (KES ${priceDetails.roomPriceKES} per night)`, 20, yPosition);\n        yPosition += 8;\n        \n        pdf.text(`Total Nights: ${priceDetails.numberOfNights}`, 20, yPosition);\n        yPosition += 8;\n        \n        if (parseInt(booking.children) > 0) {\n          pdf.setTextColor(255, 140, 0);\n          pdf.text(`* Children charges to be discussed upon arrival`, 20, yPosition);\n          yPosition += 8;\n          pdf.setTextColor(0, 0, 0);\n        }\n        \n        pdf.setFont(\"helvetica\", \"bold\");\n        pdf.text(`Total Amount: KES ${priceDetails.totalPriceKES}`, 20, yPosition);\n        yPosition += 15;\n      }\n      \n      const paymentStatus = booking.payment_status || 'pending';\n      let statusColor = [0, 0, 0];\n      let statusText = 'PENDING';\n      \n      if (paymentStatus === 'partial_paid') {\n        statusColor = [255, 140, 0];\n        statusText = 'PARTIAL PAID';\n      } else if (paymentStatus === 'payment_made') {\n        statusColor = [0, 128, 0];\n        statusText = 'PAYMENT MADE';\n      } else if (paymentStatus === 'pending') {\n        statusColor = [255, 165, 0];\n        statusText = 'WAITING FOR ADMIN CONFIRMATION';\n      } else {\n        statusColor = [255, 0, 0];\n        statusText = 'PENDING PAYMENT';\n      }\n      \n      pdf.setTextColor(...statusColor);\n      pdf.text(`Payment Status: ${statusText}`, 20, yPosition);\n      pdf.setTextColor(0, 0, 0);\n      yPosition += 15;\n      \n      pdf.setFontSize(9);\n      pdf.setTextColor(128, 128, 128);\n      pdf.text(`Booking created on: ${new Date(booking.created_at).toLocaleDateString(\"en-US\", {\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\",\n        hour: \"2-digit\",\n        minute: \"2-digit\"\n      })}`, 20, yPosition);\n      yPosition += 10;\n      \n      pdf.text(\"Please present this confirmation at check-in. For any queries, contact our front desk.\", 20, pageHeight - 20);\n      \n      pdf.save(`booking-confirmation-${booking.id}.pdf`);\n      \n    } catch (error) {\n      console.error(\"Error generating PDF:\", error);\n      alert(\"Failed to generate PDF. Please try again.\");\n    } finally {\n      setGeneratingPDF(prev => ({ ...prev, [booking.id]: false }));\n    }\n  };\n\n  // Helper function for payment status display\n  const getPaymentStatusDisplay = (paymentStatus) => {\n    switch (paymentStatus) {\n      case 'pending':\n        return { \n          text: 'Waiting for Admin Confirmation', \n          color: 'bg-orange-100 text-orange-800', \n          icon: faClock \n        };\n      case 'partial_paid':\n        return { \n          text: 'Partial Paid', \n          color: 'bg-blue-100 text-blue-800', \n          icon: faCheckCircle \n        };\n      case 'payment_made':\n        return { \n          text: 'Payment Made', \n          color: 'bg-green-100 text-green-800', \n          icon: faCheckCircle \n        };\n      default:\n        return { \n          text: 'Pending Payment', \n          color: 'bg-amber-100 text-amber-800', \n          icon: faClock \n        };\n    }\n  };\n\n  // Enhanced Quick Amount Buttons\n  const quickAmountButtons = (totalAmount) => [\n    { label: \"25%\", value: Math.max(10, Math.round(totalAmount * 0.25)) },\n    { label: \"50%\", value: Math.round(totalAmount * 0.5) },\n    { label: \"75%\", value: Math.round(totalAmount * 0.75) },\n    { label: \"Full Amount\", value: totalAmount }\n  ];\n\n  // Calculate price details for current booking\n  const getCurrentBookingPriceDetails = () => {\n    if (!currentBooking) return null;\n    return calculateTotalPrice(currentBooking);\n  };\n\n  // Enhanced Payment Modal Component with Fixed Issues\n  const PaymentModal = () => {\n    const currentBookingPriceDetails = getCurrentBookingPriceDetails();\n    \n    if (!showPaymentModal || !currentBooking || !currentBookingPriceDetails) return null;\n\n    return (\n      <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50\">\n        <div className=\"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col border border-gray-200\">\n          {/* Modal Header */}\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200 bg-white\">\n            <h3 className=\"text-2xl font-bold text-gray-900\">\n              Make M-Pesa Payment\n            </h3>\n            <button\n              onClick={closePaymentModal}\n              className=\"text-gray-400 hover:text-gray-600 transition-colors p-2 rounded-full hover:bg-gray-100\"\n              disabled={processingPayment[currentBooking?.id]}\n            >\n              <FontAwesomeIcon icon={faTimes} className=\"text-xl\" />\n            </button>\n          </div>\n          \n          {/* Modal Content - Scrollable */}\n          <div className=\"flex-1 overflow-y-auto p-6 space-y-6\">\n            {/* Error Display */}\n            {paymentErrors.general && (\n              <div className=\"bg-red-50 border border-red-200 rounded-xl p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <FontAwesomeIcon icon={faExclamationTriangle} className=\"text-red-500\" />\n                  <p className=\"text-red-700 font-medium\">{paymentErrors.general}</p>\n                </div>\n              </div>\n            )}\n\n            {/* Fixed Phone Number Input - No more single digit issue */}\n            <div>\n              <label className=\"block text-sm font-semibold text-gray-800 mb-3\">\n                M-Pesa Phone Number\n              </label>\n              <div className=\"relative\">\n                {/* Country Code Badge */}\n                <div className=\"absolute left-3 top-1/2 transform -translate-y-1/2 flex items-center gap-2 bg-gray-100 px-3 py-2 rounded-l-lg border-r border-gray-300\">\n                  <span className=\"text-sm font-medium text-gray-700\">KE</span>\n                  <span className=\"text-sm text-gray-500\">+254</span>\n                </div>\n                \n                <input\n                  ref={phoneInputRef}\n                  type=\"tel\"\n                  inputMode=\"numeric\"\n                  placeholder=\"0722 123 456\"\n                  value={formatPhoneDisplay(phoneNumber)}\n                  onChange={(e) => handlePhoneNumberChange(e.target.value)}\n                  disabled={processingPayment[currentBooking?.id]}\n                  className={`w-full pl-24 pr-4 py-3 border rounded-xl focus:outline-none focus:ring-2 transition-colors ${\n                    paymentErrors.phone \n                      ? 'border-red-300 focus:ring-red-500' \n                      : 'border-gray-300 focus:ring-green-500 focus:border-transparent'\n                  } ${processingPayment[currentBooking?.id] ? 'bg-gray-100 cursor-not-allowed' : ''}`}\n                />\n              </div>\n              \n              {paymentErrors.phone ? (\n                <div className=\"flex items-center gap-2 mt-2\">\n                  <FontAwesomeIcon icon={faExclamationTriangle} className=\"text-red-500 text-sm\" />\n                  <p className=\"text-red-600 text-sm font-medium\">{paymentErrors.phone}</p>\n                </div>\n              ) : (\n                <p className=\"text-gray-500 text-xs mt-2\">\n                  Enter your Safaricom M-Pesa number. Examples: 0722 123 456, 254 722 123 456\n                </p>\n              )}\n            </div>\n\n            {/* Enhanced Amount Input */}\n            <div>\n              <label className=\"block text-sm font-semibold text-gray-800 mb-3\">\n                Payment Amount\n              </label>\n              <div className=\"relative\">\n                <div className=\"absolute left-3 top-1/2 transform -translate-y-1/2\">\n                  <span className=\"text-gray-700 font-medium\">KES</span>\n                </div>\n                <input\n                  type=\"text\"\n                  inputMode=\"decimal\"\n                  placeholder=\"Enter amount\"\n                  value={paymentAmount}\n                  onChange={(e) => handleAmountChange(e.target.value)}\n                  disabled={processingPayment[currentBooking?.id]}\n                  className={`w-full pl-14 pr-4 py-3 border rounded-xl focus:outline-none focus:ring-2 transition-colors ${\n                    paymentErrors.amount \n                      ? 'border-red-300 focus:ring-red-500' \n                      : 'border-gray-300 focus:ring-green-500 focus:border-transparent'\n                  } ${processingPayment[currentBooking?.id] ? 'bg-gray-100 cursor-not-allowed' : ''}`}\n                />\n              </div>\n              \n              {paymentErrors.amount && (\n                <div className=\"flex items-center gap-2 mt-2\">\n                  <FontAwesomeIcon icon={faExclamationTriangle} className=\"text-red-500 text-sm\" />\n                  <p className=\"text-red-600 text-sm font-medium\">{paymentErrors.amount}</p>\n                </div>\n              )}\n              \n              {/* Enhanced Quick Amount Buttons */}\n              <div className=\"grid grid-cols-2 gap-3 mt-4\">\n                {quickAmountButtons(currentBookingPriceDetails.totalPriceKES).map((button, index) => (\n                  <button\n                    key={index}\n                    type=\"button\"\n                    onClick={() => setPaymentAmount(button.value.toString())}\n                    disabled={processingPayment[currentBooking?.id]}\n                    className=\"px-4 py-3 text-sm bg-gradient-to-r from-cyan-50 to-blue-50 hover:from-cyan-100 hover:to-blue-100 text-cyan-700 border border-cyan-200 rounded-xl transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed font-medium shadow-sm\"\n                  >\n                    {button.label}\n                    <div className=\"text-xs text-cyan-600 mt-1\">\n                      KES {button.value.toLocaleString()}\n                    </div>\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            {/* Enhanced Total Amount Info */}\n            <div className=\"bg-gradient-to-r from-cyan-50 to-blue-50 border border-cyan-200 rounded-xl p-4\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm font-semibold text-cyan-800\">Total Booking Amount:</span>\n                <span className=\"text-lg font-bold text-cyan-600\">\n                  KES {currentBookingPriceDetails.totalPriceKES.toLocaleString()}\n                </span>\n              </div>\n              {parseFloat(paymentAmount) < currentBookingPriceDetails.totalPriceKES && parseFloat(paymentAmount) > 0 && (\n                <div className=\"mt-3 pt-3 border-t border-cyan-200\">\n                  <div className=\"flex justify-between items-center text-amber-600\">\n                    <span className=\"text-sm font-medium\">Remaining Balance:</span>\n                    <span className=\"text-sm font-bold\">\n                      KES {(currentBookingPriceDetails.totalPriceKES - parseFloat(paymentAmount)).toLocaleString()}\n                    </span>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Enhanced Payment Instructions */}\n            <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-4\">\n              <h4 className=\"font-semibold text-blue-800 mb-3 flex items-center gap-2\">\n                <FontAwesomeIcon icon={faCreditCard} />\n                Payment Instructions:\n              </h4>\n              <ol className=\"text-sm text-blue-700 space-y-2\">\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold mt-0.5\">1</span>\n                  Enter your M-Pesa registered phone number\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold mt-0.5\">2</span>\n                  Enter the payment amount or use quick buttons\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold mt-0.5\">3</span>\n                  Click \"Pay KES Y\" to receive M-Pesa prompt\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold mt-0.5\">4</span>\n                  Enter your M-Pesa PIN when prompted\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"bg-blue-200 text-blue-800 rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold mt-0.5\">5</span>\n                  Wait for admin confirmation (status updates automatically)\n                </li>\n              </ol>\n            </div>\n          </div>\n\n          {/* Modal Actions */}\n          <div className=\"flex space-x-4 p-6 border-t border-gray-200 bg-gray-50\">\n            <button\n              onClick={closePaymentModal}\n              disabled={processingPayment[currentBooking?.id]}\n              className=\"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300 font-semibold disabled:opacity-50 disabled:cursor-not-allowed shadow-sm\"\n            >\n              Cancel\n            </button>\n            <button\n              onClick={handleMpesaPayment}\n              disabled={processingPayment[currentBooking?.id] || !phoneNumber || !paymentAmount}\n              className=\"flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl hover:from-green-700 hover:to-green-800 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all duration-300 font-semibold flex items-center justify-center gap-2 shadow-lg hover:shadow-xl\"\n            >\n              {processingPayment[currentBooking?.id] ? (\n                <>\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                  Initiating...\n                </>\n              ) : (\n                <>\n                  <FontAwesomeIcon icon={faCreditCard} />\n                  Pay KES {parseFloat(paymentAmount || 0).toLocaleString()}\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 py-8 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Loading your bookings...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 py-8 flex items-center justify-center\">\n        <div className=\"bg-white rounded-2xl shadow-lg border border-gray-200 p-8 text-center max-w-md\">\n          <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <FontAwesomeIcon icon={faExclamationTriangle} className=\"text-red-600 text-2xl\" />\n          </div>\n          <h3 className=\"text-red-800 font-bold text-xl mb-2\">Error Loading Bookings</h3>\n          <p className=\"text-red-600 mb-6\">{error}</p>\n          <div className=\"flex space-x-3 justify-center\">\n            <button\n              onClick={fetchBookings}\n              className=\"bg-cyan-600 hover:bg-cyan-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2\"\n            >\n              <FontAwesomeIcon icon={faSync} />\n              Try Again\n            </button>\n            <button\n              onClick={() => window.location.href = \"/\"}\n              className=\"bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2\"\n            >\n              <FontAwesomeIcon icon={faHome} />\n              Go Home\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 py-8\">\n      <div className=\"max-w-7xl mx-auto px-4\">\n        {/* Header Section */}\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-4xl font-bold text-gray-900 mb-4\">My Bookings</h1>\n          <p className=\"text-gray-600 text-lg\">Manage your reservations and payments in one place</p>\n        </div>\n        \n        {/* Exchange Rate Display */}\n        {exchangeRate && (\n          <div className=\"mb-8 bg-gradient-to-r from-cyan-50 to-blue-50 border border-cyan-200 rounded-2xl p-6 shadow-sm\">\n            <div className=\"flex flex-col sm:flex-row items-center justify-between\">\n              <div className=\"flex items-center gap-4 mb-4 sm:mb-0\">\n                <div className=\"w-12 h-12 bg-cyan-100 rounded-full flex items-center justify-center\">\n                  <FontAwesomeIcon icon={faReceipt} className=\"text-cyan-600 text-xl\" />\n                </div>\n                <div>\n                  <p className=\"text-cyan-800 font-semibold\">Current Exchange Rate</p>\n                  <p className=\"text-cyan-600\">1 USD = {exchangeRate} KES</p>\n                </div>\n              </div>\n              <button\n                onClick={fetchExchangeRate}\n                className=\"bg-cyan-600 hover:bg-cyan-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2\"\n              >\n                <FontAwesomeIcon icon={faSync} />\n                Refresh Rate\n              </button>\n            </div>\n          </div>\n        )}\n\n        {bookings.length === 0 ? (\n          <div className=\"bg-white rounded-2xl shadow-lg border border-gray-200 p-12 text-center\">\n            <div className=\"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6\">\n              <FontAwesomeIcon icon={faReceipt} className=\"text-gray-400 text-3xl\" />\n            </div>\n            <h3 className=\"text-2xl font-bold text-gray-900 mb-3\">No bookings yet</h3>\n            <p className=\"text-gray-500 mb-8 text-lg\">You haven't made any reservations yet.</p>\n            <button\n              onClick={() => window.location.href = \"/\"}\n              className=\"bg-cyan-600 hover:bg-cyan-700 text-white px-8 py-4 rounded-xl font-semibold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl\"\n            >\n              Book Now\n            </button>\n          </div>\n        ) : (\n          <div className=\"space-y-6\">\n            {bookings.map((booking) => {\n              const priceDetails = calculateTotalPrice(booking);\n              const totalGuests = calculateTotalGuests(booking.adults, booking.children);\n              const hasChildren = parseInt(booking.children) > 0;\n              const paymentStatus = booking.payment_status || 'not_paid';\n              const isProcessing = processingPayment[booking.id];\n              const hasRoomPrice = roomPrices[booking.room_type];\n              const isGeneratingPDF = generatingPDF[booking.id];\n              const paymentStatusDisplay = getPaymentStatusDisplay(paymentStatus);\n              const isPaid = paymentStatus === 'partial_paid' || paymentStatus === 'payment_made';\n              const isWaitingForAdmin = paymentStatus === 'pending';\n              const isNotPaid = paymentStatus === 'not_paid' || !paymentStatus;\n\n              return (\n                <div key={booking.id} className=\"bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden transition-all duration-300 hover:shadow-xl\">\n                  <div className=\"p-8\">\n                    <div className=\"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6\">\n                      <div className=\"flex-1\">\n                        {/* Header with Room Type and Status */}\n                        <div className=\"flex flex-col sm:flex-row sm:items-center justify-between mb-6\">\n                          <h3 className=\"text-2xl font-bold text-gray-900 mb-2 sm:mb-0\">{booking.room_type}</h3>\n                          <div className=\"flex items-center gap-3\">\n                            {getStatusBadge(booking.check_in, booking.check_out)}\n                            <span className={`${paymentStatusDisplay.color} text-xs font-medium px-3 py-1 rounded-full flex items-center gap-2`}>\n                              <FontAwesomeIcon icon={paymentStatusDisplay.icon} className=\"text-xs\" />\n                              {paymentStatusDisplay.text}\n                            </span>\n                          </div>\n                        </div>\n                        \n                        {/* Booking ID */}\n                        <div className=\"mb-6\">\n                          <span className=\"text-sm font-medium text-gray-500\">Booking ID: </span>\n                          <span className=\"text-sm font-semibold text-cyan-600\">#{booking.id}</span>\n                        </div>\n                        \n                        {/* Booking Details Grid */}\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6\">\n                          <div className=\"bg-gray-50 rounded-xl p-4\">\n                            <div className=\"flex items-center gap-3 mb-2\">\n                              <div className=\"w-8 h-8 bg-cyan-100 rounded-full flex items-center justify-center\">\n                                <FontAwesomeIcon icon={faCalendarDay} className=\"text-cyan-600 text-sm\" />\n                              </div>\n                              <div>\n                                <p className=\"text-sm font-medium text-gray-900\">Check-in</p>\n                                <p className=\"text-gray-600\">{formatDate(booking.check_in)}</p>\n                              </div>\n                            </div>\n                          </div>\n                          \n                          <div className=\"bg-gray-50 rounded-xl p-4\">\n                            <div className=\"flex items-center gap-3 mb-2\">\n                              <div className=\"w-8 h-8 bg-cyan-100 rounded-full flex items-center justify-center\">\n                                <FontAwesomeIcon icon={faCalendarDay} className=\"text-cyan-600 text-sm\" />\n                              </div>\n                              <div>\n                                <p className=\"text-sm font-medium text-gray-900\">Check-out</p>\n                                <p className=\"text-gray-600\">{formatDate(booking.check_out)}</p>\n                              </div>\n                            </div>\n                          </div>\n                          \n                          <div className=\"bg-gray-50 rounded-xl p-4\">\n                            <div className=\"flex items-center gap-3 mb-2\">\n                              <div className=\"w-8 h-8 bg-cyan-100 rounded-full flex items-center justify-center\">\n                                <FontAwesomeIcon icon={faReceipt} className=\"text-cyan-600 text-sm\" />\n                              </div>\n                              <div>\n                                <p className=\"text-sm font-medium text-gray-900\">Guests</p>\n                                <div className=\"text-gray-600\">\n                                  <span className=\"block\">Adults: {booking.adults || 1}</span>\n                                  <span className=\"block\">Children: {booking.children || 0}</span>\n                                  <span className=\"block font-medium mt-1\">Total: {totalGuests}</span>\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                          \n                          <div className=\"bg-gray-50 rounded-xl p-4\">\n                            <div className=\"flex items-center gap-3 mb-2\">\n                              <div className=\"w-8 h-8 bg-cyan-100 rounded-full flex items-center justify-center\">\n                                <FontAwesomeIcon icon={faReceipt} className=\"text-cyan-600 text-sm\" />\n                              </div>\n                              <div>\n                                <p className=\"text-sm font-medium text-gray-900\">Nationality</p>\n                                <p className=\"text-gray-600\">{booking.nationality || 'Not specified'}</p>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Stay Duration */}\n                        <div className=\"mb-4\">\n                          <span className=\"font-medium text-gray-900\">Stay Duration: </span>\n                          <span className=\"text-cyan-600 font-semibold\">\n                            {priceDetails ? priceDetails.numberOfNights : 'Calculating...'} nights\n                          </span>\n                        </div>\n                        \n                        {/* Price Breakdown */}\n                        <div className=\"mt-6 pt-6 border-t border-gray-200\">\n                          <h4 className=\"font-bold text-gray-900 mb-4 text-lg\">Price Breakdown</h4>\n                          \n                          {loadingRoomPrices || loadingExchangeRate ? (\n                            <div className=\"text-center py-6\">\n                              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500 mx-auto\"></div>\n                              <p className=\"text-gray-500 mt-3 font-medium\">\n                                {loadingRoomPrices ? 'Loading room prices...' : 'Fetching exchange rate...'}\n                              </p>\n                            </div>\n                          ) : !hasRoomPrice || !exchangeRate ? (\n                            <div className=\"text-center py-6 bg-amber-50 rounded-xl p-4\">\n                              <FontAwesomeIcon icon={faExclamationTriangle} className=\"text-amber-600 text-2xl mb-3\" />\n                              <p className=\"text-amber-700 font-medium mb-4\">\n                                {!hasRoomPrice ? 'Awaiting response from server for room prices' : 'Unable to fetch exchange rate'}\n                              </p>\n                              <div className=\"flex space-x-3 justify-center\">\n                                {!hasRoomPrice && (\n                                  <button\n                                    onClick={fetchRoomPrices}\n                                    className=\"bg-amber-500 hover:bg-amber-600 text-white px-5 py-2 rounded-xl font-semibold transition-all duration-300\"\n                                  >\n                                    Retry Room Prices\n                                  </button>\n                                )}\n                                {!exchangeRate && (\n                                  <button\n                                    onClick={fetchExchangeRate}\n                                    className=\"bg-amber-500 hover:bg-amber-600 text-white px-5 py-2 rounded-xl font-semibold transition-all duration-300\"\n                                  >\n                                    Retry Exchange Rate\n                                  </button>\n                                )}\n                              </div>\n                            </div>\n                          ) : (\n                            <div className=\"bg-gradient-to-r from-cyan-50 to-blue-50 rounded-2xl p-6 space-y-4\">\n                              <div className=\"flex justify-between items-center\">\n                                <span className=\"text-gray-700\">Room price (USD):</span>\n                                <span className=\"font-semibold\">${priceDetails.roomPriceUSD} per night</span>\n                              </div>\n                              \n                              <div className=\"flex justify-between items-center text-green-600\">\n                                <span>Converted to KES:</span>\n                                <span className=\"font-semibold\">KES {priceDetails.roomPriceKES} per night</span>\n                              </div>\n                              \n                              <div className=\"flex justify-between items-center\">\n                                <span>Duration:</span>\n                                <span className=\"font-semibold\">{priceDetails.numberOfNights} nights</span>\n                              </div>\n\n                              {hasChildren && (\n                                <div className=\"flex justify-between items-center bg-amber-100 rounded-xl p-4\">\n                                  <span className=\"font-medium text-amber-700\">Children charges:</span>\n                                  <span className=\"font-medium text-amber-700\">To be discussed upon arrival</span>\n                                </div>\n                              )}\n                              \n                              <div className=\"flex justify-between items-center pt-4 border-t border-cyan-200\">\n                                <span className=\"text-xl font-bold text-gray-900\">Total Price (KES):</span>\n                                <span className=\"text-2xl font-bold text-cyan-600\">\n                                  KES {priceDetails.totalPriceKES}\n                                </span>\n                              </div>\n\n                              {hasChildren && (\n                                <div className=\"text-sm text-amber-600 mt-2\">\n                                  * Final total may vary based on children charges discussed at check-in\n                                </div>\n                              )}\n                            </div>\n                          )}\n                        </div>\n\n                        {/* Booking Date */}\n                        <div className=\"mt-6 text-sm text-gray-500\">\n                          Booked on: {new Date(booking.created_at).toLocaleDateString(\"en-US\", {\n                            year: \"numeric\",\n                            month: \"long\",\n                            day: \"numeric\",\n                            hour: \"2-digit\",\n                            minute: \"2-digit\"\n                          })}\n                        </div>\n                      </div>\n                      \n                      {/* Action Buttons */}\n                      <div className=\"lg:w-64 flex flex-col space-y-4\">\n                        {!hasRoomPrice || !exchangeRate || loadingRoomPrices || loadingExchangeRate ? (\n                          <button\n                            disabled\n                            className=\"w-full px-6 py-4 bg-gray-300 text-gray-500 rounded-xl font-semibold cursor-not-allowed\"\n                          >\n                            {loadingRoomPrices || loadingExchangeRate ? 'Loading...' : 'Awaiting Price Information'}\n                          </button>\n                        ) : isNotPaid ? (\n                          // Not paid state - show payment button\n                          <button\n                            onClick={() => openPaymentModal(booking, priceDetails.totalPriceKES)}\n                            disabled={isProcessing}\n                            className={`w-full px-6 py-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-3 ${\n                              isProcessing\n                                ? 'bg-gray-400 text-gray-200 cursor-not-allowed'\n                                : 'bg-green-600 hover:bg-green-700 text-white shadow-lg hover:shadow-xl'\n                            }`}\n                          >\n                            {isProcessing ? (\n                              <>\n                                <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"></div>\n                                Initiating...\n                              </>\n                            ) : (\n                              <>\n                                <FontAwesomeIcon icon={faCreditCard} />\n                                Pay KES {priceDetails.totalPriceKES}\n                              </>\n                            )}\n                          </button>\n                        ) : isWaitingForAdmin ? (\n                          // Waiting for admin confirmation state - show disabled button\n                          <button\n                            disabled\n                            className=\"w-full px-6 py-4 bg-orange-100 text-orange-800 rounded-xl font-semibold cursor-not-allowed flex items-center justify-center gap-3\"\n                          >\n                            <FontAwesomeIcon icon={faClock} />\n                            Waiting for Admin Confirmation\n                          </button>\n                        ) : isPaid ? (\n                          // Paid state - show appropriate paid button (disabled)\n                          <button\n                            disabled\n                            className={`w-full px-6 py-4 rounded-xl font-semibold cursor-not-allowed flex items-center justify-center gap-3 ${\n                              paymentStatus === 'partial_paid' \n                                ? 'bg-blue-100 text-blue-800' \n                                : 'bg-green-100 text-green-800'\n                            }`}\n                          >\n                            <FontAwesomeIcon icon={faCheckCircle} />\n                            {paymentStatus === 'partial_paid' ? 'Partial Payment Made' : 'Payment Made'}\n                          </button>\n                        ) : null}\n                        \n                        {/* Cancellation button */}\n                        <button\n                          onClick={() => handleCancelBooking(booking.id)}\n                          disabled={isWaitingForAdmin || isPaid}\n                          className={`w-full px-6 py-4 border rounded-xl font-semibold transition-all duration-300 flex items-center justify-center gap-3 ${\n                            isWaitingForAdmin || isPaid\n                              ? 'border-gray-300 text-gray-400 bg-gray-100 cursor-not-allowed'\n                              : 'border-red-300 text-red-600 hover:bg-red-50 hover:scale-105'\n                          }`}\n                        >\n                          <FontAwesomeIcon icon={faTimes} />\n                          {isWaitingForAdmin || isPaid ? 'Cancellation Not Available' : 'Cancel Booking'}\n                        </button>\n\n                        {/* Download PDF button - Only visible when paid */}\n                        {isPaid && (\n                          <button\n                            onClick={() => generateBookingPDF(booking)}\n                            disabled={isGeneratingPDF}\n                            className={`w-full px-6 py-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-3 ${\n                              isGeneratingPDF\n                                ? 'bg-gray-400 text-gray-200 cursor-not-allowed'\n                                : 'bg-cyan-600 hover:bg-cyan-700 text-white shadow-lg hover:shadow-xl'\n                            }`}\n                          >\n                            {isGeneratingPDF ? (\n                              <>\n                                <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"></div>\n                                Generating...\n                              </>\n                            ) : (\n                              <>\n                                <FontAwesomeIcon icon={faDownload} />\n                                Download PDF\n                              </>\n                            )}\n                          </button>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n\n        {/* Payment Modal */}\n        <PaymentModal />\n      </div>\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}